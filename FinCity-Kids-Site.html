<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
<title>FinCity ¬∑ –î–µ—Ç—Å–∫–∞—è –∞–∫–∞–¥–µ–º–∏—è —Ñ–∏–Ω–∞–Ω—Å–æ–≤</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:opsz,wght@14..32,400;14..32,500;14..32,600;14..32,700&display=swap" rel="stylesheet">
<!-- –ò–∫–æ–Ω–∫–∏ -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

<style>
  * {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
  }

  :root {
    --primary: #1A3B5C;        
    --primary-light: #2B4D73;
    --accent: #4FACFE;        
    --gradient-start: #6A11CB;  
    --gradient-end: #2575FC;
    --success: #1DB954;
    --warning: #FFB347;
    --danger: #FF6B6B;
    --dark: #0F2A40;
    --light-bg: #F4F7FC;
    --card-white: #FFFFFF;
    --text-primary: #1E293B;
    --text-secondary: #5B6F87;
    --border-light: #E9EEF4;
    --shadow-card: 0 20px 30px -10px rgba(26, 59, 92, 0.15);
    --shadow-hover: 0 25px 35px -8px rgba(79, 172, 254, 0.25);
    --transition: all 0.2s ease;
  }

  body {
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
    background: var(--light-bg);
    color: var(--text-primary);
    line-height: 1.5;
    min-height: 100vh;
    background-image: radial-gradient(circle at 10% 20%, rgba(106, 17, 203, 0.03) 0%, transparent 30%),
                      radial-gradient(circle at 90% 70%, rgba(37, 117, 252, 0.03) 0%, transparent 30%);
  }

  header {
    background: var(--primary);
    color: white;
    padding: 16px 24px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    flex-wrap: wrap;
    box-shadow: 0 4px 12px rgba(0,0,0,0.08);
  }

  .logo {
    display: flex;
    align-items: center;
    gap: 12px;
    font-weight: 700;
    font-size: 1.6rem;
    letter-spacing: -0.5px;
  }

  .logo i {
    background: linear-gradient(135deg, var(--gradient-start), var(--gradient-end));
    -webkit-background-clip: text;
    background-clip: text;
    color: transparent;
    font-size: 2rem;
    filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2));
  }

  .badge {
    background: rgba(255,255,255,0.15);
    backdrop-filter: blur(4px);
    padding: 6px 14px;
    border-radius: 40px;
    font-size: 0.9rem;
    font-weight: 500;
    border: 1px solid rgba(255,255,255,0.2);
  }

  .badge i {
    margin-right: 6px;
    color: var(--warning);
  }

  .container {
    max-width: 720px;
    margin: 24px auto;
    padding: 0 20px;
  }

  .card {
    background: var(--card-white);
    border-radius: 32px;
    padding: 28px 26px;
    box-shadow: var(--shadow-card);
    margin-bottom: 22px;
    border: 1px solid var(--border-light);
    transition: var(--transition);
    backdrop-filter: blur(2px);
    animation: floatIn 0.4s cubic-bezier(0.2, 0.9, 0.3, 1);
  }

  .card:hover {
    box-shadow: var(--shadow-hover);
    transform: translateY(-3px);
  }

  @keyframes floatIn {
    0% { opacity: 0; transform: translateY(20px); }
    100% { opacity: 1; transform: translateY(0); }
  }

  h2, h3 {
    font-weight: 600;
    letter-spacing: -0.3px;
    display: flex;
    align-items: center;
    gap: 8px;
  }

  h3 { font-size: 1.5rem; margin-bottom: 0.5rem; }
  h3 i { color: var(--accent); font-size: 1.8rem; }

  .input-group {
    position: relative;
    margin: 16px 0;
  }

  .input-group i {
    position: absolute;
    left: 16px;
    top: 50%;
    transform: translateY(-50%);
    color: var(--text-secondary);
    font-size: 1.1rem;
  }

  input, textarea, select {
    width: 100%;
    padding: 16px 20px 16px 48px;
    border: 2px solid var(--border-light);
    border-radius: 24px;
    font-size: 1rem;
    font-family: 'Inter', sans-serif;
    background: white;
    transition: var(--transition);
    color: var(--text-primary);
    font-weight: 500;
  }

  input:focus, textarea:focus, select:focus {
    border-color: var(--accent);
    box-shadow: 0 0 0 4px rgba(79, 172, 254, 0.2);
    outline: none;
  }

  button {
    border: none;
    background: white;
    font-weight: 600;
    font-size: 1rem;
    padding: 16px 24px;
    border-radius: 40px;
    cursor: pointer;
    transition: var(--transition);
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    border: 1px solid transparent;
    position: relative;
    overflow: hidden;
    letter-spacing: -0.2px;
  }

  button::after {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 0;
    height: 0;
    border-radius: 50%;
    background: rgba(255,255,255,0.4);
    transform: translate(-50%, -50%);
    transition: width 0.4s, height 0.4s;
  }

  button:active::after {
    width: 200px;
    height: 200px;
  }

  .primary {
    background: linear-gradient(135deg, var(--gradient-start), var(--gradient-end));
    color: white;
    box-shadow: 0 8px 18px -6px var(--gradient-start);
  }

  .primary:hover {
    transform: scale(1.02);
    box-shadow: 0 14px 24px -8px var(--gradient-end);
  }

  .blue {
    background: var(--primary);
    color: white;
    border: 1px solid rgba(255,255,255,0.1);
  }

  .blue:hover {
    background: var(--primary-light);
    transform: translateY(-2px);
  }

  .gray {
    background: #F1F4F9;
    color: var(--text-primary);
    border: 1px solid #DCE3EC;
  }

  .gray:hover {
    background: #E5EAf2;
  }

  .success {
    background: var(--success);
    color: white;
  }

  .success:hover { background: #16a34a; }

  .back-button {
    background: transparent;
    color: var(--primary);
    border: 2px solid var(--border-light);
    padding: 12px 20px;
    margin-bottom: 15px;
  }

  .back-button:hover {
    background: var(--primary);
    color: white;
    border-color: var(--primary);
  }

  .progressbar {
    height: 12px;
    background: #E2E9F3;
    border-radius: 40px;
    margin: 20px 0 12px;
    overflow: hidden;
    box-shadow: inset 0 1px 3px #0000001a;
  }

  .progress {
    height: 100%;
    background: linear-gradient(90deg, var(--success), #8BC34A);
    width: 0%;
    transition: width 1s cubic-bezier(0.2, 0.9, 0.3, 1);
    border-radius: 40px;
    position: relative;
  }

  .lesson-content {
    background: #F0F5FE;
    padding: 24px;
    border-radius: 28px;
    margin: 24px 0;
    border-left: 6px solid var(--accent);
    font-size: 1.1rem;
    box-shadow: inset 0 2px 8px rgba(0,0,0,0.02);
    line-height: 1.7;
  }

  .answer {
    background: #F0F4FA;
    border: 2px solid transparent;
    justify-content: flex-start;
    padding: 16px 20px;
    margin: 8px 0;
    font-weight: 500;
    width: 100%;
  }

  .answer:hover:not(:disabled) {
    border-color: var(--accent);
    background: white;
    transform: translateX(6px);
  }

  .correct {
    background: linear-gradient(145deg, #1DB954, #179f46) !important;
    color: white !important;
    border-color: #0b8c3a !important;
  }

  .wrong {
    background: linear-gradient(145deg, #FF6B6B, #ee5252) !important;
    color: white !important;
    border-color: #c03939 !important;
  }

  .bank-actions, .market-input-group {
    display: flex;
    gap: 10px;
    margin: 18px 0;
    flex-wrap: wrap;
  }

  .bank-actions input, .market-input-group input {
    flex: 2 1 160px;       
    min-width: 0;            
    margin: 0;
    width: auto;           
  }

  .bank-actions button, .market-input-group button {
    flex: 1 1 auto;
    margin: 0;
    white-space: nowrap;
  }

  .withdraw-button {
    background: var(--warning);
    color: var(--dark);
    border: none;
  }

  .withdraw-button:hover {
    background: #ffa01e;
  }

  hr {
    border: none;
    height: 2px;
    background: linear-gradient(90deg, transparent, var(--border-light), transparent);
    margin: 28px 0;
  }

  .price-ticker {
    background: #EDF2F9;
    padding: 10px 18px;
    border-radius: 40px;
    display: inline-block;
    font-weight: 700;
    font-size: 1.2rem;
  }

  .price-ticker i {
    color: var(--primary);
    margin-right: 8px;
  }

  .profile-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    flex-wrap: wrap;
    background: #F0F5FE;
    padding: 18px 22px;
    border-radius: 60px;
    margin-bottom: 24px;
    gap: 12px;
  }

  .profile-name {
    font-weight: 700;
    font-size: 1.3rem;
    background: var(--primary);
    color: white;
    padding: 6px 22px;
    border-radius: 40px;
    display: inline-flex;
    align-items: center;
    gap: 8px;
  }

  .level-badge {
    background: white;
    border-radius: 100px;
    padding: 8px 20px;
    font-weight: 600;
    box-shadow: 0 4px 12px rgba(0,0,0,0.02);
  }

  .emoji-big { font-size: 2rem; filter: drop-shadow(2px 4px 4px rgba(0,0,0,0.1)); }

  /* –ú–û–ë–ò–õ–¨–ù–ê–Ø –ê–î–ê–ü–¢–ê–¶–ò–Ø */
  @media (max-width: 600px) {
    header {
      flex-direction: column;
      align-items: flex-start;
      gap: 10px;
    }
    .badge {
      align-self: flex-start;
    }
    .logo {
      font-size: 1.4rem;
    }
    .container {
      padding: 0 12px;
      margin: 16px auto;
    }
    .card {
      padding: 20px 18px;
    }
    .profile-row {
      flex-direction: column;
      align-items: stretch;
      border-radius: 40px;
    }
    .profile-name, .level-badge {
      width: fit-content;
    }
    h3 {
      font-size: 1.3rem;
    }
    .bank-actions, .market-input-group {
      flex-direction: column;
    }
    .bank-actions button, .market-input-group button {
      width: 100%;
    }
    .bank-actions input, .market-input-group input {
      width: 100%;
      min-width: 0;
    }
    .price-ticker {
      font-size: 1rem;
      padding: 8px 14px;
    }
    .answer {
      padding: 14px 16px;
    }
  }

  @media (max-width: 400px) {
    .logo span {
      font-size: 1.2rem;
    }
    .badge {
      font-size: 0.8rem;
    }
  }
</style>
</head>
<body>

<header>
  <div class="logo">
    <i class="fas fa-landmark"></i> 
    <span>FinCity¬∑–î–µ—Ç—Å–∫–∞—è –∞–∫–∞–¥–µ–º–∏—è</span>
  </div>
  <div class="badge">
    <i class="fas fa-gem"></i> –Æ–Ω—ã–π —Ñ–∏–Ω–∞–Ω—Å–∏—Å—Ç
  </div>
</header>

<div class="container" id="app"></div>

<script>
  (function() {
    // –ù–µ–π–º–∏–Ω–≥
    let state = JSON.parse(localStorage.getItem("fincity_pro")) || {
      registered: false,
      name: "",
      age: 0,
      xp: 0,
      level: 1,
      balance: 100,
      progress: 1,
      savings: 0,
      portfolio: { USD: 0, BTC: 0 },
      prices: { USD: 90, BTC: 3000000 }
    };

    function save() { localStorage.setItem("fincity_pro", JSON.stringify(state)); }

    function render() { state.registered ? showMainMenu() : showRegistration(); }

    // –†–ï–ì–ò–°–¢–†–ê–¶–ò–Ø
    function showRegistration() {
      app.innerHTML = `
        <div class="card">
          <div style="text-align: center; margin-bottom: 20px;">
            <span class="emoji-big">üöÄ</span>
            <h2 style="color: var(--primary);">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ FinCity</h2>
            <p style="color: var(--text-secondary);">–ê–∫–∞–¥–µ–º–∏—è —é–Ω—ã—Ö —Ñ–∏–Ω–∞–Ω—Å–∏—Å—Ç–æ–≤</p>
          </div>
          <div class="input-group">
            <i class="fas fa-user"></i>
            <input id="regName" placeholder="–¢–≤–æ—ë –∏–º—è (–±–µ–∑ —Ü–∏—Ñ—Ä)" autocomplete="off">
          </div>
          <div class="input-group">
            <i class="fas fa-calendar-alt"></i>
            <input id="regAge" type="number" placeholder="–í–æ–∑—Ä–∞—Å—Ç 6‚Äì12" min="6" max="12">
          </div>
          <button class="primary" onclick="registerUser()"><i class="fas fa-paper-plane"></i> –°—Ç–∞—Ç—å —Ñ–∏–Ω–∞–Ω—Å–∏—Å—Ç–æ–º</button>
          <p style="margin-top: 16px; font-size:0.9rem"><i class="fas fa-shield-alt"></i> –û–±—É—á–µ–Ω–∏–µ –≤ –∏–≥—Ä–æ–≤–æ–π —Ñ–æ—Ä–º–µ, –Ω–∏–∫–∞–∫–∏—Ö —Ä–∏—Å–∫–æ–≤</p>
        </div>
      `;
    }

    window.registerUser = function() {
      let name = document.getElementById("regName")?.value.trim() || "";
      let age = parseInt(document.getElementById("regAge")?.value);
      if (/\d/.test(name)) return alert("–ò–º—è –Ω–µ –¥–æ–ª–∂–Ω–æ —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ü–∏—Ñ—Ä—ã");
      if (isNaN(age) || age < 6 || age > 12) return alert("–í–æ–∑—Ä–∞—Å—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Ç 6 –¥–æ 12 –ª–µ—Ç");
      state.registered = true;
      state.name = name;
      state.age = age;
      save();
      showMainMenu();
    };

    // –ì–õ–ê–í–ù–û–ï –ú–ï–ù–Æ
    function showMainMenu() {
      let xpProgress = (state.xp % 100);
      app.innerHTML = `
        <div class="card">
          <div class="profile-row">
            <span class="profile-name"><i class="fas fa-user-astronaut"></i> ${state.name}</span>
            <span class="level-badge"><i class="fas fa-star" style="color: #FFB347;"></i> –£—Ä–æ–≤–µ–Ω—å ${state.level}  | XP ${state.xp}</span>
          </div>
          <div style="display: flex; align-items: baseline; justify-content: space-between;">
            <span style="font-size: 1.2rem;"><i class="fas fa-wallet"></i> –ë–∞–ª–∞–Ω—Å</span>
            <span style="font-size: 2.2rem; font-weight: 700; color: var(--primary);">${state.balance.toFixed(2)} ‚ÇΩ</span>
          </div>
          <div class="progressbar">
            <div class="progress" style="width: ${xpProgress}%;"></div>
          </div>
          <p style="display: flex; gap: 12px; margin-top: 8px;">
            <i class="fas fa-rocket" style="color: var(--accent);"></i> –î–æ —Å–ª–µ–¥—É—é—â–µ–≥–æ —É—Ä–æ–≤–Ω—è: ${100 - xpProgress} XP
          </p>
          <div style="display: grid; gap: 12px; margin-top: 24px;">
            <button class="primary" onclick="showLessons()"><i class="fas fa-graduation-cap"></i> –£—Ä–æ–∫–∏</button>
            <button class="blue" onclick="openBank()"><i class="fas fa-piggy-bank"></i> –ë–∞–Ω–∫</button>
            <button class="blue" onclick="openMarket()"><i class="fas fa-chart-line"></i> –ë–∏—Ä–∂–∞</button>
          </div>
        </div>
      `;
    }

    //–£–†–û–ö–ò
    const lessonsList = [
      { title: "–ß—Ç–æ —Ç–∞–∫–æ–µ –¥–µ–Ω—å–≥–∏?",
        pages: ["–î–µ–Ω—å–≥–∏ ‚Äî —ç—Ç–æ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π —Ç–æ–≤–∞—Ä, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–Ω–æ –æ–±–º–µ–Ω—è—Ç—å –Ω–∞ –≤—Å—ë —á—Ç–æ —É–≥–æ–¥–Ω–æ. –í –¥—Ä–µ–≤–Ω–æ—Å—Ç–∏ –ª—é–¥–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ —Ä–∞–∫—É—à–∫–∏, –∫–∞–∫–∞–æ-–±–æ–±—ã –∏ –¥–∞–∂–µ —Å–∫–æ—Ç!",
                "–°–µ–≥–æ–¥–Ω—è —É –Ω–∞—Å –µ—Å—Ç—å –±—É–º–∞–∂–Ω—ã–µ –∫—É–ø—é—Ä—ã, –º–æ–Ω–µ—Ç—ã –∏ —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω—ã–µ –¥–µ–Ω—å–≥–∏ –Ω–∞ –∫–∞—Ä—Ç–∞—Ö. –í –†–æ—Å—Å–∏–∏ —ç—Ç–æ —Ä—É–±–ª–∏. –ù–∞ –∫—É–ø—é—Ä–∞—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω—ã –¥–æ—Å—Ç–æ–ø—Ä–∏–º–µ—á–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏.",
                "–¢—Ä–∏ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–µ–Ω–µ–≥: –º–µ—Ä–∞ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ (—Ü–µ–Ω–∞), —Å—Ä–µ–¥—Å—Ç–≤–æ –æ–±–º–µ–Ω–∞ (–ø–æ–∫—É–ø–∫–∞) –∏ –Ω–∞–∫–æ–ø–ª–µ–Ω–∏–µ (–∫–æ–ø–∏–ª–∫–∞)."],
        questions: [
          { q: "–î–µ–Ω—å–≥–∏ ‚Äî —ç—Ç–æ...", a: ["–¢–æ–ª—å–∫–æ –±—É–º–∞–≥–∞", "–°—Ä–µ–¥—Å—Ç–≤–æ –æ–±–º–µ–Ω–∞"], c: 1 },
          { q: "–ß—Ç–æ –∏–∑ —ç—Ç–æ–≥–æ –±—ã–ª–æ –¥–µ–Ω—å–≥–∞–º–∏?", a: ["–†–∞–∫—É—à–∫–∏", "–°–º–∞—Ä—Ç—Ñ–æ–Ω—ã"], c: 0 },
          { q: "–í–∞–ª—é—Ç–∞ –†–æ—Å—Å–∏–∏?", a: ["–†—É–±–ª—å", "–Æ–∞–Ω—å"], c: 0 },
          { q: "–ì–¥–µ —Ö—Ä–∞–Ω—è—Ç—Å—è —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω—ã–µ –¥–µ–Ω—å–≥–∏?", a: ["–í –±–∞–Ω–∫–µ/–∫–∞—Ä—Ç–µ", "–í –æ–±–ª–∞–∫–∞—Ö"], c: 0 },
          { q: "–î–ª—è —á–µ–≥–æ –ù–ï –Ω—É–∂–Ω—ã –¥–µ–Ω—å–≥–∏?", a: ["–ò–∑–º–µ—Ä—è—Ç—å —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—É", "–ü–æ–∫—É–ø–∞—Ç—å –∏–≥—Ä—É—à–∫–∏"], c: 0 }
        ] },
      { title: "–ö–∞–∫ –∫–æ–ø–∏—Ç—å –¥–µ–Ω—å–≥–∏? ",
        pages: ["–ö–æ–ø–∏—Ç—å ‚Äî –≤–∞–∂–Ω–æ –¥–ª—è –±–æ–ª—å—à–æ–π –º–µ—á—Ç—ã: –≤–µ–ª–æ—Å–∏–ø–µ–¥, –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ. –ö–æ–ø–∏–ª–∫–∞ ‚Äî –ø–µ—Ä–≤—ã–π —à–∞–≥.",
                "–ë–∞–Ω–∫ –Ω–µ –ø—Ä–æ—Å—Ç–æ —Ö—Ä–∞–Ω–∏—Ç, –Ω–æ –∏ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –¥–µ–Ω—å–≥–∏ —Å –ø–æ–º–æ—â—å—é –ø—Ä–æ—Ü–µ–Ω—Ç–æ–≤ (–≤–∫–ª–∞–¥).",
                "–°–æ–≤–µ—Ç—ã: –æ—Ç–∫–ª–∞–¥—ã–≤–∞—Ç—å —á–∞—Å—Ç—å –∫–∞—Ä–º–∞–Ω–Ω—ã—Ö, –Ω–µ —Ç—Ä–∞—Ç–∏—Ç—å –Ω–∞ –º–µ–ª–æ—á–∏, –≤–µ—Å—Ç–∏ —É—á—ë—Ç."],
        questions: [
          { q: "–ì–¥–µ –¥–µ–Ω—å–≥–∏ –±—É–¥—É—Ç –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏ —Ä–∞—Å—Ç–∏?", a: ["–í –±–∞–Ω–∫–µ", "–ü–æ–¥ –º–∞—Ç—Ä–∞—Å–æ–º"], c: 0 },
          { q: "–ü—Ä–æ—Ü–µ–Ω—Ç—ã –≤ –±–∞–Ω–∫–µ ‚Äî —ç—Ç–æ...", a: ["–ü–æ–¥–∞—Ä–æ–∫", "–ü–ª–∞—Ç–∞ –∑–∞ —Ö—Ä–∞–Ω–µ–Ω–∏–µ"], c: 1 },
          { q: "–ß—Ç–æ–±—ã –±—ã—Å—Ç—Ä–µ–µ –Ω–∞–∫–æ–ø–∏—Ç—å, –Ω—É–∂–Ω–æ...", a: ["–¢—Ä–∞—Ç–∏—Ç—å –≤—Å—ë", "–û—Ç–∫–ª–∞–¥—ã–≤–∞—Ç—å —Ä–µ–≥—É–ª—è—Ä–Ω–æ"], c: 1 },
          { q: "–ö–æ–ø–∏–ª–∫–∞ –ø–æ–º–æ–≥–∞–µ—Ç?", a: ["–î–∞", "–ù–µ—Ç, —Ç–æ–ª—å–∫–æ —Ç—Ä–∞—Ç–∏—Ç—å"], c: 0 },
          { q: "–õ—É—á—à–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è?", a: ["–ß–∞—Å—Ç—å –¥–æ—Ö–æ–¥–æ–≤ —Å—Ä–∞–∑—É –æ—Ç–∫–ª–∞–¥—ã–≤–∞—Ç—å", "–ñ–¥–∞—Ç—å –≤—ã–∏–≥—Ä—ã—à–∞"], c: 0 }
        ] },
      { title: "–£–º–Ω—ã–µ —Ç—Ä–∞—Ç—ã!",
        pages: ["–î—É–º–∞–π, –Ω—É–∂–Ω–∞ –ª–∏ –≤–µ—â—å –Ω–∞ —Å–∞–º–æ–º –¥–µ–ª–µ. –ò–º–ø—É–ª—å—Å–∏–≤–Ω—ã–µ –ø–æ–∫—É–ø–∫–∏ –æ–ø—É—Å—Ç–æ—à–∞—é—Ç –∫–æ—à–µ–ª—ë–∫.",
                "–°—Ä–∞–≤–Ω–∏–≤–∞–π —Ü–µ–Ω—ã –≤ –º–∞–≥–∞–∑–∏–Ω–∞—Ö. –û–¥–∏–Ω —Ç–æ–≤–∞—Ä –º–æ–∂–µ—Ç —Å—Ç–æ–∏—Ç—å –ø–æ-—Ä–∞–∑–Ω–æ–º—É.",
                "–°–æ—Å—Ç–∞–≤–ª—è–π —Å–ø–∏—Å–æ–∫ –ø–æ–∫—É–ø–æ–∫ ‚Äî —ç—Ç–æ —ç–∫–æ–Ω–æ–º–∏—Ç –¥–µ–Ω—å–≥–∏ –∏ –≤—Ä–µ–º—è."],
        questions: [
          { q: "–ü–µ—Ä–µ–¥ –ø–æ–∫—É–ø–∫–æ–π –≤–∞–∂–Ω–æ...", a: ["–ü–æ–¥—É–º–∞—Ç—å", "–°—Ä–∞–∑—É –∫—É–ø–∏—Ç—å"], c: 0 },
          { q: "–≠–∫–æ–Ω–æ–º–∏—è ‚Äî —ç—Ç–æ...", a: ["–£–º–Ω–æ", "–°—Ç—ã–¥–Ω–æ"], c: 0 },
          { q: "–ß—Ç–æ –ø–æ–º–æ–≥–∞–µ—Ç –Ω–µ –∫—É–ø–∏—Ç—å –ª–∏—à–Ω–µ–≥–æ?", a: ["–°–ø–∏—Å–æ–∫", "–ë–æ–ª—å—à–∞—è —Ç–µ–ª–µ–∂–∫–∞"], c: 0 },
          { q: "–ï—Å–ª–∏ –≤–µ—â—å –¥–µ—à–µ–≤–ª–µ –≤ –¥—Ä—É–≥–æ–º –º–µ—Å—Ç–µ, –ª—É—á—à–µ...", a: ["–ö—É–ø–∏—Ç—å —Ç–∞–º", "–í—Å—ë —Ä–∞–≤–Ω–æ –∫—É–ø–∏—Ç—å –∑–¥–µ—Å—å"], c: 0 },
          { q: "–°–∫–∏–¥–∫–∏ ‚Äî —ç—Ç–æ —Ö–æ—Ä–æ—à–æ, –µ—Å–ª–∏...", a: ["–í–µ—â—å –Ω—É–∂–Ω–∞", "–ö—É–ø–∏—Ç—å –ø—Ä–æ –∑–∞–ø–∞—Å"], c: 0 }
        ] }
    ];

    let currentLessonIndex = 0;
    window.showLessons = function() {
      let html = `<div class="card">
        <button class="back-button" onclick="showMainMenu()"><i class="fas fa-arrow-left"></i> –ù–∞–∑–∞–¥</button>
        <h3><i class="fas fa-books"></i> –í—ã–±–µ—Ä–∏ —É—Ä–æ–∫</h3>`;
      lessonsList.forEach((l, idx) => {
        html += `<button class="blue" style="justify-content: left; margin: 8px 0;" onclick="startLesson(${idx}, 0)"><i class="fas ${l.icon}"></i> ${l.title}</button>`;
      });
      html += '</div>';
      app.innerHTML = html;
    };

    window.startLesson = function(lessonIdx, page) {
      currentLessonIndex = lessonIdx;
      let l = lessonsList[lessonIdx];
      let html = `<div class="card">
        <button class="back-button" onclick="showLessons()"><i class="fas fa-arrow-left"></i> –ù–∞–∑–∞–¥ –∫ —É—Ä–æ–∫–∞–º</button>
        <h3><i class="fas ${l.icon}"></i> ${l.title}</h3>
        <div class="lesson-content">${l.pages[page]}</div>`;
      if (page < l.pages.length - 1) {
        html += `<button class="primary" onclick="startLesson(${lessonIdx}, ${page+1})">–î–∞–ª—å—à–µ <i class="fas fa-arrow-right"></i></button>`;
      } else {
        html += `<button class="primary" onclick="startTest(${lessonIdx})"><i class="fas fa-pencil-alt"></i> –ü—Ä–æ–π—Ç–∏ —Ç–µ—Å—Ç</button>`;
      }
      html += "</div>";
      app.innerHTML = html;
    };

    // –¢–ï–°–¢–´
    let currentScore = 0, testLessonIndex = 0;

    window.startTest = function(lessonIdx) {
      testLessonIndex = lessonIdx;
      currentScore = 0;
      let l = lessonsList[lessonIdx];
      let html = `<div class="card">
        <button class="back-button" onclick="showLessons()"><i class="fas fa-arrow-left"></i> –ù–∞–∑–∞–¥</button>
        <h3><i class="fas fa-clipboard-list"></i> –¢–µ—Å—Ç: ${l.title}</h3>`;
      l.questions.forEach((q, qIdx) => {
        html += `<div class="card" style="padding: 20px;" data-qindex="${qIdx}">
          <p style="font-weight: 600;">${qIdx+1}. ${q.q}</p>`;
        q.a.forEach((ans, aIdx) => {
          let isCorrect = (aIdx === q.c);
          html += `<button class="answer" onclick="handleAnswer(this, ${isCorrect}, ${qIdx})">${ans}</button>`;
        });
        html += "</div>";
      });
      html += `<button class="primary" onclick="finishTest()"><i class="fas fa-check-circle"></i> –ó–∞–≤–µ—Ä—à–∏—Ç—å —Ç–µ—Å—Ç</button></div>`;
      app.innerHTML = html;
    };

    window.handleAnswer = function(btn, isCorrect, qIdx) {
      let container = btn.closest('.card[data-qindex]');
      if (container.dataset.answered === 'true') return;
      container.dataset.answered = 'true';
      let btns = container.querySelectorAll('.answer');
      btns.forEach(b => b.disabled = true);
      if (isCorrect) {
        btn.classList.add('correct');
        currentScore++;
      } else {
        btn.classList.add('wrong');
        btns.forEach(b => {
          if (b.onclick && b.onclick.toString().includes('true')) b.classList.add('correct');
        });
      }
    };

    window.finishTest = function() {
      let rub = currentScore * 20;
      let xp = currentScore * 15;
      state.balance += rub;
      state.xp += xp;
      while (state.xp >= state.level * 100) state.level++;
      save();
      alert(`üéâ –†–µ–∑—É–ª—å—Ç–∞—Ç: ${currentScore}/5\n+${rub} ‚ÇΩ\n+${xp} XP`);
      showMainMenu();
    };

    // –ë–ê–ù–ö
    let bankInterval;
    window.openBank = function() {
      if (bankInterval) clearInterval(bankInterval);
      renderBank();
    };

    function renderBank() {
      app.innerHTML = `
        <div class="card">
          <button class="back-button" onclick="showMainMenu()"><i class="fas fa-arrow-left"></i> –ù–∞–∑–∞–¥</button>
          <h3><i class="fas fa-university"></i> –ë–∞–Ω–∫ ¬´–ö–æ–ø–∏–ª–∫–∞¬ª</h3>
          <p style="font-size: 2rem; font-weight: 700;">${state.savings.toFixed(2)} ‚ÇΩ <span style="font-size:1rem;">–Ω–∞–∫–æ–ø–ª–µ–Ω–æ</span></p>
          <div class="bank-actions">
            <input id="depositAmount" type="number" placeholder="–°—É–º–º–∞ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è" min="0.01" step="0.01">
            <button class="primary" onclick="deposit()"><i class="fas fa-arrow-up"></i> –ü–æ–ø–æ–ª–Ω–∏—Ç—å</button>
          </div>    
          <div class="bank-actions">
            <input id="withdrawAmount" type="number" placeholder="–°—É–º–º–∞ –≤—ã–≤–æ–¥–∞" min="0.01" step="0.01">
            <button class="withdraw-button" onclick="withdraw()"><i class="fas fa-arrow-down"></i> –í—ã–≤–µ—Å—Ç–∏</button>
          </div>
          <div class="progressbar"><div id="bankProgress" class="progress" style="width:0%"></div></div>
          <p><i class="fas fa-hourglass-half"></i> –ü—Ä–æ—Ü–µ–Ω—Ç—ã (5%) —á–µ—Ä–µ–∑ <span id="bankTimer">120</span> —Å</p>
          <p style="color: var(--success);"><i class="fas fa-gift"></i> –ö–∞–∂–¥—ã–µ 2 –º–∏–Ω—É—Ç—ã +5% –∫ –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è–º</p>
        </div>
      `;
      startBankTimer();
    }

    window.deposit = function() {
      let val = parseFloat(document.getElementById('depositAmount')?.value);
      if (val > 0 && val <= state.balance) {
        state.balance -= val;
        state.savings += val;
        save();
        renderBank();
      } else alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤ –∏–ª–∏ –Ω–µ–≤–µ—Ä–Ω–∞—è —Å—É–º–º–∞');
    };

    window.withdraw = function() {
      let val = parseFloat(document.getElementById('withdrawAmount')?.value);
      if (val > 0 && val <= state.savings) {
        state.savings -= val;
        state.balance += val;
        save();
        renderBank();
      } else alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –Ω–∞–∫–æ–ø–ª–µ–Ω–∏–π');
    };

    function startBankTimer() {
      let timeLeft = 120;
      if (bankInterval) clearInterval(bankInterval);
      bankInterval = setInterval(() => {
        timeLeft--;
        let timerSpan = document.getElementById('bankTimer');
        let progBar = document.getElementById('bankProgress');
        if (timerSpan) timerSpan.innerText = timeLeft;
        if (progBar) progBar.style.width = (100 - (timeLeft / 120 * 100)) + '%';
        if (timeLeft <= 0) {
          clearInterval(bankInterval);
          state.savings = state.savings * 1.05;
          save();
          if (document.getElementById('bankTimer')) renderBank(); 
        }
      }, 1000);
    }

    // –ë–ò–†–ñ–ê
    window.openMarket = function() {
      state.prices.USD += (Math.random() - 0.5) * 2;
      state.prices.BTC += (Math.random() - 0.5) * 60000;
      if (state.prices.USD < 10) state.prices.USD = 10;
      if (state.prices.BTC < 500000) state.prices.BTC = 500000;

      app.innerHTML = `
        <div class="card">
          <button class="back-button" onclick="showMainMenu()"><i class="fas fa-arrow-left"></i> –ù–∞–∑–∞–¥</button>
          <h3><i class="fas fa-chart-pie"></i> –ë–∏—Ä–∂–∞ ¬´–Æ–Ω—ã–π —Ç—Ä–µ–π–¥–µ—Ä¬ª</h3>
          
          <div class="card" style="background: #F2F8FF;">
            <h4><i class="fas fa-dollar-sign" style="color: #2e7d32;"></i> –î–æ–ª–ª–∞—Ä USD</h4>
            <div class="price-ticker"><i class="fas fa-tag"></i> ${state.prices.USD.toFixed(2)} ‚ÇΩ</div>
            <p>–í –ø–æ—Ä—Ç—Ñ–µ–ª–µ: ${state.portfolio.USD.toFixed(4)} USD ‚âà ${(state.portfolio.USD * state.prices.USD).toFixed(2)} ‚ÇΩ</p>
            <div class="market-input-group">
              <input id="usdQty" type="number" placeholder="–ö–æ–ª-–≤–æ USD" step="0.01" min="0">
              <button class="primary" onclick="buyAsset('USD')"><i class="fas fa-cart-plus"></i> –ö—É–ø–∏—Ç—å</button>
              <button class="blue" onclick="sellAsset('USD')"><i class="fas fa-arrow-alt-circle-right"></i> –ü—Ä–æ–¥–∞—Ç—å</button>
            </div>
          </div>

          <div class="card" style="background: #FFF3E0;">
            <h4><i class="fab fa-bitcoin" style="color: #f7931a;"></i> –ë–∏—Ç–∫–æ–∏–Ω BTC</h4>
            <div class="price-ticker"><i class="fas fa-tag"></i> ${state.prices.BTC.toFixed(0)} ‚ÇΩ</div>
            <p>–í –ø–æ—Ä—Ç—Ñ–µ–ª–µ: ${state.portfolio.BTC.toFixed(6)} BTC ‚âà ${(state.portfolio.BTC * state.prices.BTC).toFixed(2)} ‚ÇΩ</p>
            <div class="market-input-group">
              <input id="btcQty" type="number" placeholder="–ö–æ–ª-–≤–æ BTC" step="0.000001" min="0">
              <button class="primary" onclick="buyAsset('BTC')"><i class="fas fa-cart-plus"></i> –ö—É–ø–∏—Ç—å</button>
              <button class="blue" onclick="sellAsset('BTC')"><i class="fas fa-arrow-alt-circle-right"></i> –ü—Ä–æ–¥–∞—Ç—å</button>
            </div>
          </div>
          <p style="font-size: 1.2rem;"><i class="fas fa-coins"></i> –î–æ—Å—Ç—É–ø–Ω–æ: ${state.balance.toFixed(2)} ‚ÇΩ</p>
        </div>
      `;
    };

    window.buyAsset = function(asset) {
      let id = asset === 'USD' ? 'usdQty' : 'btcQty';
      let amount = parseFloat(document.getElementById(id)?.value);
      if (!amount || amount <= 0) return alert('–í–≤–µ–¥–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ');
      let cost = amount * state.prices[asset];
      if (cost <= state.balance) {
        state.balance -= cost;
        state.portfolio[asset] += amount;
        save();
        openMarket();
      } else alert('–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç –¥–µ–Ω–µ–≥');
    };

    window.sellAsset = function(asset) {
      let id = asset === 'USD' ? 'usdQty' : 'btcQty';
      let amount = parseFloat(document.getElementById(id)?.value);
      if (!amount || amount <= 0) return alert('–í–≤–µ–¥–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ');
      if (amount <= state.portfolio[asset]) {
        state.portfolio[asset] -= amount;
        state.balance += amount * state.prices[asset];
        save();
        openMarket();
      } else alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∞–∫—Ç–∏–≤–∞');
    };

    // –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    window.showMainMenu = showMainMenu;
    render();
  })();
</script>
</body>
</html>
